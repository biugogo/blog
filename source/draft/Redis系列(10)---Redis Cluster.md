# Redis系列(10)---Redis Cluster

## Redis Cluster能带来什么
1. 数据在多节点自动分区能力
2. 在部分节点挂掉后，继续提供服务的高可用能力


## Redis Cluster端口
Redis Cluster的每个node需要占用两个端口。默认6379和16379（前一个节点加10000）.6379用于客户端通信，16379 bus端口用于集群内部通信（点对点二进制通信端口，用于失败检测，配置更新，故障转移等）。如果bus端口不可用，Redis Cluster无法进行故障转移等功能。


## 分片规则
Redis Cluster不是使用一致性hash，而是使用hash slot---哈希槽。
### 普通hash、consistent hash(一致性hash)和hash slot（哈希槽）差别
1. 普通hash：hash计算的值，跟你想要key被hash到的节点数量是相关想。当节点数量发生变化，同一key的hash值会发生变化。例子：把int64的uid分配到5台机器上，选择uid%5来分配，机器变化为6台时，hash算法变为uid%6。hash值发生变化。

2. 一致性hash：节点变化不会影响key的hash值。
    * 构建一个哈希环（hash ring）（2的32次方-1）
    * 计算缓存对象的哈希值放入
    * 计算缓存节点（ip或者主机名）的哈希值放入
    * 从缓存对象所在的位置顺时针查找最近的缓存节点位置
    * **缺点**： 一致性哈希算法无法满足平衡性，所以需要引入虚拟节点的概念，通过为缓存节点创建N个虚拟节点（例如为ip或者主机名加上%N后缀），使缓存对象更均匀的分布在哈希环上。
3. hash slot：先规划好slot个数，hash会分配到slot上，不同主机分配不同slot范围。通过预先规划和变动槽对应的缓存节点，就能满足单调性和平衡性。
    * 规划槽的数量（常见1024（codis）或者16383（redis-cluster））
    * 每个槽对应一个可重复的缓存节点

## 一致性问题

## 添加删除主备节点
## 